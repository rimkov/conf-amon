<?xml version='1.0' encoding='utf-8'?>

<creole>
    <files>
        <file name='/usr/share/eole/firewall/00_proxy.fw'/>
        <file name='/usr/share/eole/dansguardian/dansguardian1.conf' />
        <file name='/usr/share/eole/dansguardian/dansguardian2.conf' />
        <file name='/etc/lightsquid/lightsquid.cfg' />
        <!--Les logs sont sur le maitre donc ils doivent tourner sur le maitre -->
        <file name='/etc/logrotate.d/squid3' source='squid.logrotate'/>
    </files>
    <containers>
        <container name="proxy" id='20'>
            <package>proxy-pkg</package>
            <package>antivirus-pkg</package>
            <service>squid</service>
            <service method='upstart'>rsyslog</service>
            <service pty="False">dansguardian</service>
            <service servicelist='clamav_proxy' in_container='True'>clamav-daemon</service>
            <interface linkto="eth1" ip="adresse_ip_eth1_proxy_link" mask="adresse_mask_eth1_proxy_link" bcast="adresse_bcast_eth1_proxy_link">eth1</interface>
            <interface interfacelist='eth2_proxy_link' linkto="eth2" ip="adresse_ip_eth2_proxy_link" mask="adresse_mask_eth2_proxy_link" bcast="adresse_bcast_eth2_proxy_link">eth2</interface>
            <interface interfacelist='eth3_proxy_link' linkto="eth3" ip="adresse_ip_eth3_proxy_link" mask="adresse_mask_eth3_proxy_link" bcast="adresse_bcast_eth3_proxy_link">eth3</interface>
            <file name='/etc/dansguardian/languages/french/fancydmtemplate.html' />
            <file name='/etc/pam.d/squid' source='squid.pam'/>
            <file name='/etc/logrotate.d/dansguardian' source='dansguardian.logrotate'/>
            <file name='/etc/dansguardian/languages/french/template.html' source='dansguardian-template.html'/>
            <file name='/etc/dansguardian/languages/french/template-liste_blanche.html' source='dansguardian-template-liste_blanche.html'/>
            <file name='/etc/dansguardian/languages/french/template-moderateur.html' source='dansguardian-template-moderateur.html'/>
            <file name='/etc/dansguardian/languages/french/template-utilisateur_interdits.html' source='dansguardian-template-utilisateur_interdits.html'/>
            <file name='/etc/squid/squid.conf' del_comment='#'/>
            <file name='/etc/squid/domaines_nocache'/>
            <file name='/etc/squid/domaines_noauth'/>
            <file name='/usr/lib/cgi-bin/filtre.cgi' mode='755'/>
            <file name='/etc/rsyslog.d/50-default.conf' source="50-default-conteneur.conf" container_only="True"/>
            <file name='/etc/rsyslog.d/20-squid.conf' source="20-squid-conteneur.conf" container_only="True"/>
            <!-- remontée des logs pour les adresses interdites dans l'EAD -->
            <file name='/etc/rsyslog.d/20-iptables.conf' source="20-iptables-conteneur.conf" container_only="True"/>
            <!--authentification-->
            <package>authentification-pkg</package>
            <service servicelist='kerberos' method='upstart'>smbd</service>
            <service servicelist='kerberos' method='upstart'>nmbd</service>
            <service servicelist='kerberos'>winbind</service>
            <service servicelist='kerberos'>krb5-admin-server</service>
            <service servicelist='kerberos'>krb5-kdc</service>
            <file filelist='kerberos' name='/etc/samba/smb.conf' />
            <file filelist='kerberos' name='/etc/samba/lmhosts' />
            <file filelist='kerberos' name='/etc/krb5.conf' />
            <!-- clamav : génère même si pas activé pour le mode non conteneur-->
            <file filelist='clamav' name='/etc/clamav/clamd.conf'/>
        </container>
    </containers>

    <variables>

        <family name='general'>
            <variable name='adresse_ip_proxy' type='ip' hidden='True' description="Adresse IP du conteneur proxy"/>
            <variable name='url_maj_blacklist' type='string' description='URL mise à jour des blacklists' mode='expert'>
                <value>http://eole.orion.education.fr/maj/blacklists</value>
            </variable>
        </family>

        <family name='authentification'>
            <variable name='num_dansguardian_instance' type='string' description="Nombre de filtres web (DansGuardian et pare-feu) configurables" hidden='True'>
                <value>2</value>
            </variable>
            <variable name='activer_squid_auth' type='oui/non' description="Activer l'authentification web (proxy)" >
                <value>non</value>
            </variable>
        </family>

        <family name='clamav' hidden='True'>
            <variable name='dansguardian_clam' type='oui/non' description="Activer l'anti-virus sur le proxy">
                <value>non</value>
            </variable>
            <variable name='test_activer_clam_proxy' type='oui/non' hidden='True'/>
        </family>

        <family name='Interface-1'>
            <variable name='nom_machine_eth1' type='string' description="Nom à donner à l'interface (pour résolution DNS)" exists="False">
                <value>admin</value>
            </variable>
            <!--**** variable de configuration pour dansguardian (choix de l'instance) ****-->
            <variable name='dansguardian_eth1' type='string' description='Filtre web à appliquer sur cette interface' >
                <value>1</value>
            </variable>
            <variable name='squid_auth_eth1' type='oui/non' description="Activer l'authentification sur cette interface (s'applique aussi aux VLAN)" >
                <value>oui</value>
            </variable>
            <variable name='adresse_ip_eth1_proxy_link' type='ip' description="Adresse IP pour le proxy" />
            <variable name='adresse_mask_eth1_proxy_link' type='ip' description="Masque de sous réseau du proxy"/>
            <variable name='adresse_bcast_eth1_proxy_link' type='ip' description="Broadcast pour le proxy"/>
        </family>
        <family name='Interface-2'>
            <!-- variable de configuration pour dansguardian (choix de l'instance) -->
            <variable name='dansguardian_eth2' type='string' description='Filtre web à appliquer sur cette interface' >
                <value>1</value>
            </variable>
            <variable name='squid_auth_eth2' type='oui/non' description="Activer l'authentification sur cette interface (s'applique aussi aux VLAN)" >
                <value>oui</value>
            </variable>
            <variable name='adresse_ip_eth2_proxy_link' type='ip' description="Adresse IP pour le proxy" />
            <variable name='adresse_mask_eth2_proxy_link' type='ip' description="Masque de sous réseau du proxy"/>
            <variable name='adresse_bcast_eth2_proxy_link' type='ip' description="Broadcast pour le proxy"/>
        </family>
        <family name='Interface-3'>
            <!-- variable de configuration pour dansguardian (choix de l'instance) -->
            <variable name='dansguardian_eth3' type='string' description='Filtre web à appliquer sur cette interface' >
                <value>1</value>
            </variable>
            <variable name='squid_auth_eth3' type='oui/non' description="Activer l'authentification sur cette interface (s'applique aussi aux VLAN)" >
                <value>oui</value>
            </variable>
            <variable name='adresse_ip_eth3_proxy_link' type='ip' description="Adresse IP pour le proxy" />
            <variable name='adresse_mask_eth3_proxy_link' type='ip' description="Masque de sous réseau du proxy"/>
            <variable name='adresse_bcast_eth3_proxy_link' type='ip' description="Broadcast pour le proxy"/>
        </family>
        <family name='Interface-4'>
            <!-- variable de configuration pour dansguardian (choix de l'instance) -->
            <variable name='dansguardian_eth4' type='string' description='Filtre web à appliquer sur cette interface' >
                <value>1</value>
            </variable>
            <variable name='squid_auth_eth4' type='oui/non' description="Activer l'authentification sur cette interface (s'applique aussi aux VLAN)" >
                <value>oui</value>
            </variable>
        </family>

        <family name='dansguardian' mode='expert'>
            <variable name="dans_num_opt_filters" type="string" description='Nombre de politiques optionnelles de filtrage par zone'>
                <value>3</value>
            </variable>
            <variable name="headertimeout" type="number" description='Header Timeout'>
                <value>14</value>
            </variable>
            <variable name="docheadertimeout" type="number" description='Doc Header Timeout'>
                <value>20</value>
            </variable>
            <variable name="docbodytimeout" type="number" description='Doc Body Timeout'>
                <value>120</value>
            </variable>
            <variable name="dansguardian_ead_filtre1" type="string" description="Libellé du filtre web 1 dans l'EAD">
                <value>Filtre web 1</value>
            </variable>
            <variable name="maxchildren1" type="number" description='Nombre maximum de processus'>
                <value>80</value>
            </variable>
            <variable name="minchildren1" type="number" description='Nombre minimum de processus'>
                <value>8</value>
            </variable>
            <variable name="minsparechildren1" type="number" description='Nombre minimum de processus en attente'>
                <value>4</value>
            </variable>
            <variable name="maxsparechildren1" type="number" description='Nombre maximum de processus en attente'>
                <value>32</value>
            </variable>
            <variable name="preforkchildren1" type="number" description="Nombre de processus démarré s'il en manque">
                <value>6</value>
            </variable>
            <variable name="maxagechildren1" type="number" description="Durée de vie maximum d'un processus avant de se terminer">
                <value>500</value>
            </variable>
            <variable name="dans_cachedir1" type="string" description='Répertoire de cache'>
                <value>/tmp</value>
            </variable>
            <variable name="dans_maxramsize1" type="number" description='Taille maximum de fichier conservé en mémoire'>
                <value>5000</value>
            </variable>
            <variable name="dans_maxfilesize1" type="number" description='Taille maximum de fichier conservé sur le disque'>
                <value>5000</value>
            </variable>
            <variable name="unactive_dansguardian_auth1" type="string" description="Désactiver les plugins qui logguent l'authentification sur la zone 1" hidden="True">
                <value>---</value>
            </variable>
            <variable name="dansguardian_ead_filtre2" type="string" description="Libellé du filtre web 2 dans l'EAD">
                <value>Filtre web 2</value>
            </variable>

            <variable name="maxchildren2" type="number" description='Nombre maximum de processus'>
                <value>80</value>
            </variable>
            <variable name="minchildren2" type="number" description='Nombre minimum de processus'>
                <value>8</value>
            </variable>
            <variable name="minsparechildren2" type="number" description='Nombre minimum de processus en attente'>
                <value>4</value>
            </variable>
            <variable name="maxsparechildren2" type="number" description='Nombre maximum de processus en attente'>
                <value>32</value>
            </variable>
            <variable name="preforkchildren2" type="number" description="Nombre de processus démarré s'il en manque">
                <value>6</value>
            </variable>
            <variable name="maxagechildren2" type="number" description="Durée de vie maximum d'un processus avant de se terminer">
                <value>500</value>
            </variable>
            <variable name="dans_cachedir2" type="string" description='Répertoire de cache'>
                <value>/tmp</value>
            </variable>
            <variable name="dans_maxramsize2" type="number" description='Taille maximum de fichier conservé en mémoire'>
                <value>5000</value>
            </variable>
            <variable name="dans_maxfilesize2" type="number" description='Taille maximum de fichier conservé sur le disque'>
                <value>5000</value>
            </variable>
            <variable name="unactive_dansguardian_auth2" type="string" description="Désactiver les plugins qui logguent l'authentification sur la zone 2" hidden="True">
                <value>---</value>
            </variable>
        </family>

        <family name='Proxy-pere' mode='expert'>
            <variable name='nom_cache_pere' type='string' description='Nom ou adresse IP du serveur mandataire web parent'/>
            <variable name='port_cache_pere' type='string' description='Port du serveur mandataire web parent'/>
            <variable name='proxy_pere_rvp' type='oui/non' description="Accès aux zone RVP en passant par le proxy père global ?">
                <value>non</value>
            </variable>
            <variable name='nom_cache_pere_zone' type='string' description='Utiliser le serveur mandataire web parent pour la zone' multi='True' />
            <variable name='port_cache_pere_zone' type='string' description='Port du serveur mandataire web parent pour la zone'/>
            <variable name='nom_zone_dns_cache' type='string' description='Nom DNS de la zone accessible via ce cache père'/>
            <variable name='autoriser_proxy_autres' type='oui/non' description="Autoriser l'utilisation de ce cache père par d'autres zones que eth1">
                <value>non</value>
            </variable>
        </family>

        <family name='squid' mode='expert'>
            <variable name='http_port' type='string' description="Port d'écoute HTTP de Squid" multi='True'>
                <value>127.0.0.1:8080</value>
            </variable>
            <variable name='https_port' type='string' description="Port d'écoute HTTPS de Squid"/>
            <variable name='safe_ports' type='number' description='"Safe_ports" supplémentaire' multi='True'/>
            <variable name='number_of_basic_children' type='number' description="Nombre de processus associées au module d'authentification basique">
                <value>20</value>
            </variable>
            <variable name='number_of_ntlm_children' type='number' description="Nombre de processus associées au module d'authentification NTLM">
                <value>20</value>
            </variable>
            <variable name='icp_port' type='number' description="Port d'écoute pour les requêtes ICP">
                <value>3130</value>
            </variable>
            <variable name='htcp_port' type='number' description="Port d'écoute pour les requêtes HTCP">
                <value>4827</value>
            </variable>
            <variable name='icp_query_timeout' type='number' description='Timout pour les requêtes ICP (en msec)'>
                <value>0</value>
            </variable>
            <variable name='maximum_icp_query_timeout' type='number' description='maximum_icp_query_timeout (en msec)'>
                <value>2000</value>
            </variable>
            <!-- FIXME : mcast -->
            <variable name='mcast_groups' type='string' description="Groupe de serveurs multicast" hidden='True'/>
            <variable name='mcast_icp_query_timeout' type='number' description='mcast_icp_query_timeout (en msec)' hidden='True'>
                <value>2000</value>
            </variable>
            <!-- -->
            <variable name='dead_peer_timeout' type='number' description='dead_peer_timeout (en sec)'>
                <value>10</value>
            </variable>
            <variable name='hierarchy_stoplist' type='string' description='hierarchy_stoplist'>
                <value>cgi-bin ?</value>
            </variable>
            <!--<variable name='cache_vary' type='string' description=''>
                <value>on</value>
            </variable>-->
            <variable name='cache_mem' type='number' description='Taille maximale de la mémoire cache (en MB)'>
                <value>16</value>
            </variable>
            <variable name='cache_swap_low' type='number' description='cache_swap_low (en %)'>
                <value>90</value>
            </variable>
            <variable name='cache_swap_high' type='number' description='cache_swap_high (en %)'>
                <value>95</value>
            </variable>
            <variable name='minimum_object_size' type='number' description='minimum_object_size (en KB)'>
                <value>0</value>
            </variable>
            <variable name='maximum_object_size' type='number' description='maximum_object_size (en KB)'>
                <value>32768</value>
            </variable>
            <variable name='maximum_object_size_in_memory' type='number' description='maximum_object_size_in_memory (en KB)'>
                <value>16</value>
            </variable>
            <variable name='ipcache_size' type='number' description="ipcache_size (en nombre d'entrées)">
                <value>1024</value>
            </variable>
            <variable name='ipcache_low' type='number' description='ipcache_low (en %)'>
                <value>90</value>
            </variable>
            <variable name='ipcache_high' type='number' description='ipcache_high (en %)'>
                <value>95</value>
            </variable>
            <variable name='fqdncache_size' type='number' description="fqdncache_size (en nombre d'entrées)">
                <value>1024</value>
            </variable>
            <variable name='cache_replacement_policy' type='string' description='cache_replacement_policy'>
                <value>lru</value>
            </variable>
            <variable name='memory_replacement_policy' type='string' description='memory_replacement_policy'>
                <value>lru</value>
            </variable>
            <variable name='cache_dir' type='string' description='Emplacement du cache' multi='True'>
                <value>/var/spool/squid</value>
            </variable>
            <variable name='cache_dir_type' type='string' description='Type de stockage utilisé'>
                <value>ufs</value>
            </variable>
            <variable name='cache_dir_disk_space' type='string' description='Taille du cache (en MB)'>
                <value>1000</value>
            </variable>
            <variable name='cache_dir_firstLevel' type='string' description='Nombre maximum de répertoires de niveau 1'>
                <value>16</value>
            </variable>
            <variable name='cache_dir_secondLevel' type='string' description='Nombre maximum de répertoires de niveau 2'>
                <value>256</value>
            </variable>
            <variable name='emulate_httpd_log' type='on/off' description='emulate_httpd_log'>
                <value>off</value>
            </variable>
            <variable name='log_ip_on_direct' type='on/off' description='log_ip_on_direct'>
                <value>on</value>
            </variable>
            <variable name='log_mime_hdrs' type='on/off' description='log_mime_hdrs'>
                <value>off</value>
            </variable>
            <variable name='log_fqdn' type='on/off' description='log_fqdn'>
                <value>off</value>
            </variable>
            <variable name='client_netmask' type='netmask' description='Masque réseau des clients '>
                <value>255.255.255.255</value>
            </variable>
                <variable name='ftp_user' type='string' description='Utilisateur FTP'>
                <value>ftp</value>
            </variable>
            <!--<variable name='ftp_list_width' type='number' description=''>
                <value>32</value>
            </variable>-->
            <variable name='ftp_passive' type='on/off' description='Autoriser les connexions FTP passives'>
                <value>on</value>
            </variable>
            <variable name='ftp_sanitycheck' type='on/off' description='Activer la vérification des connexions FTP'>
                <value>on</value>
            </variable>
            <variable name='ftp_telnet_protocol' type='on/off' description='ftp_telnet_protocol'>
                <value>on</value>
            </variable>
            <variable name='check_hostname' type='on/off' description="Activer la vérification des noms d'hôte">
                <value>on</value>
            </variable>
            <variable name='allow_underscore' type='on/off' description="Autoriser les underscore dans les noms d'hôte">
                <value>on</value>
            </variable>
            <!--<variable name='cache_dns_program' type='string' description=''>
                <value>/usr/lib/squid/dnsserver</value>
            </variable>-->
            <!--<variable name='dns_children' type='number' description=''>
                <value>5</value>
            </variable>
            <variable name='dns_retransmit_interval' type='number' description='en secondes'>
                <value>5</value>
            </variable>
            <variable name='dns_timeout' type='number' description='Timeout des requêtes DNS (en minutes)'>
                <value>2</value>
            </variable>-->
            <variable name='dns_defnames' type='on/off' description='dns_defnames'>
                <value>off</value>
            </variable>
            <variable name='ignore_expect_100' type='on/off' description='Autoriser les clients non conformes HTTP/1.1'>
                    <value>off</value>
            </variable>
            <variable name='dns_nameservers' type='string' description='Utiliser un DNS spécifique' multi='True'>
                <value></value>
            </variable>
            <!-- FIXME 2.3 -->
            <variable name='hosts_file' type='string' description='Emplacement du fichier hosts' hidden='True'>
                <value>/etc/hosts</value>
            </variable>
            <!--<variable name='wais_relay_host' type='string' description=''>
                <value></value>
            </variable>-->
            <!--<variable name='wais_relay_port' type='number' description=''>
                <value>0</value>
            </variable>-->
            <variable name='request_header_max_size' type='number' description='request_header_max_size (en KB)'>
                <value>20</value>
            </variable>
            <variable name='request_body_max_size' type='number' description='request_body_max_size (en MB)'>
                <value>10</value>
            </variable>
            <variable name='quick_abort_min' type='number' description='quick_abort_min (en KB)'>
                <value>16</value>
            </variable>
            <variable name='quick_abort_max' type='number' description='quick_abort_max (en KB)'>
                <value>16</value>
            </variable>
            <variable name='quick_abort_pct' type='number' description='quick_abort_pct (en %)'>
                <value>95</value>
            </variable>
            <variable name='read_ahead_gap' type='number' description='read_ahead_gap (en KB)'>
                <value>16</value>
            </variable>
            <variable name='negative_ttl' type='number' description='negative_ttl (en min)'>
                <value>5</value>
            </variable>
            <variable name='positive_dns_ttl' type='number' description='positive_dns_ttl (en heures)'>
                <value>6</value>
            </variable>
            <variable name='negative_dns_ttl' type='number' description='negative_dns_ttl (en min)'>
                <value>1</value>
            </variable>
            <variable name='range_offset_limit' type='number' description='range_offset_limit (en KB)'>
                <value>0</value>
            </variable>
            <!--<variable name='collapsed_forwarding' type='on/off' description=''>
                <value>off</value>
            </variable>-->
            <!--<variable name='refresh_stale_hit' type='number' description='(en secondes)'>
                <value>0</value>
            </variable>-->
            <variable name='forward_timeout' type='number' description='forward_timeout (en min)'>
                <value>4</value>
            </variable>
            <variable name='connect_timeout' type='number' description='connect_timeout (en min)'>
                <value>1</value>
            </variable>
            <variable name='peer_connect_timeout' type='number' description='peer_connect_timeout (en sec)'>
                <value>30</value>
            </variable>
            <variable name='read_timeout' type='number' description='read_timeout (en min)'>
                <value>15</value>
            </variable>
            <variable name='request_timeout' type='number' description='request_timeout (en min)'>
                <value>5</value>
            </variable>
            <variable name='persistent_request_timeout' type='number' description='persistent_request_timeout (en min)'>
                <value>1</value>
            </variable>
            <variable name='client_lifetime' type='number' description='client_lifetime (en min)'>
                <value>120</value>
            </variable>
            <variable name='half_closed_clients' type='on/off' description='half_closed_clients'>
                <value>on</value>
            </variable>
            <variable name='pconn_timeout' type='number' description='Timout pour les connexions persistantes (en sec)'>
                <value>120</value>
            </variable>
            <variable name='ident_timeout' type='number' description='ident_timeout (en sec)'>
                <value>10</value>
            </variable>
            <variable name='shutdown_lifetime' type='number' description='shutdown_lifetime (en sec)'>
                <value>30</value>
            </variable>
        </family>

        <family name='proxy authentifié'>
            <variable name='type_squid_auth' type='string' description="Type d'authentification" >
                <value>NTLM/SMB</value>
            </variable>
            <!-- **** LDAP **** -->
            <variable name='ip_serveur_ldap1' type='ip' description='Adresse du premier serveur LDAP' />
            <variable name='ip_serveur_ldap2' type='ip' description='Adresse du second serveur LDAP (si le 1er ne répond pas)' />
            <variable name='proxy_ldap_base_dn' type='string' description="Suffixe racine de l'annuaire LDAP (base DN)">
                <value>ou=education,o=gouv,c=fr</value>
            </variable>
            <!-- **** LDAP (Active Directory)**** -->
            <variable name='ip_serveur_ldapad' type='ip' description='Adresse IP du serveur LDAP (Active Directory)' />
            <variable name='ldapad_base_dn' type='string' description="Suffixe racine de l'annuaire LDAP (base DN Active Directory)">
                <value></value>
            </variable>
            <variable name='ldapad_user' type='string' description="Nom du compte nécessaire pour l'interrogation LDAP (Active Directory)">
                <value></value>
            </variable>
            <variable name='ldapad_passwd' type='string' description="Mot de passe du compte nécessaire pour l'interrogation LDAP (Active Directory)">
                <value></value>
            </variable>
            <!-- **** NTLM **** -->
            <variable name='nom_serveur_smb' type='string' description='Nom du contrôleur de domaine SMB' multi='True'/>
            <variable name='nom_domaine_smb' type='string' description='Nom du domaine SMB' />
            <variable name='ip_serveur_smb' type='ip' description='Adresse IP du contrôleur de domaine SMB' />
            <!-- **** KRB **** -->
            <variable name='test_activer_kerberos' type='oui/non' hidden='True'/>
            <variable name='nom_serveur_krb' type='string' description='Nom du contrôleur de domaine KERBEROS' />
            <variable name='nom_domaine_krb' type='string' description='Nom du domaine KERBEROS (fqdn)' />
            <variable name='nom_domaine_windows' type='string' description='Nom du domaine Windows' />
            <variable name='ip_serveur_krb' type='ip' description='Adresse IP du contrôleur de domaine KERBEROS' />
        </family>

        <separators>
            <separator name='dans_num_opt_filters'>Configuration commune aux deux zones</separator>
            <separator name='dansguardian_ead_filtre1'>Filtre web 1</separator>
            <separator name='dansguardian_ead_filtre2'>Filtre web 2</separator>
            <separator name='dansguardian_eth1'>Configuration de la politique de filtrage</separator>
            <separator name='dansguardian_eth2'>Configuration de la politique de filtrage</separator>
            <separator name='dansguardian_eth3'>Configuration de la politique de filtrage</separator>
            <separator name='dansguardian_eth4'>Configuration de la politique de filtrage</separator>
            <separator name='nom_cache_pere_zone'>Proxy pere par zone</separator>
            <separator name="adresse_ip_eth1_proxy_link">Adresse pour le proxy</separator>
            <separator name="adresse_ip_eth2_proxy_link">Adresse pour le proxy</separator>
            <separator name="adresse_ip_eth3_proxy_link">Adresse pour le proxy</separator>
        </separators>

    </variables>

    <constraints>

        <check name='obligatoire' target='url_maj_blacklist'/>

        <auto name='calc_container' target='adresse_ip_proxy'>
            <param type='eole'>mode_conteneur_actif</param>
            <param type='container'>proxy</param>
            <param type='eole' optional='True'>mode_zephir</param>
        </auto>
        <check name='valid_enum' target='type_squid_auth'>
            <param>['NTLM/SMB','Ldap','Ldap (Active Directory)','NTLM/KERBEROS']</param>
        </check>
        <group master='nom_serveur_smb'>
            <slave>nom_domaine_smb</slave>
            <slave>ip_serveur_smb</slave>
        </group>
        <condition name='hidden_if_in' source='nombre_interfaces'>
            <param>1</param>
            <param>2</param>
            <target type='interfacelist'>eth2_proxy_link</target>
        </condition>
        <condition name='hidden_if_in' source='nombre_interfaces'>
            <param>1</param>
            <param>2</param>
            <param>3</param>
            <target type='interfacelist'>eth3_proxy_link</target>
        </condition>

        <auto name='calc_multi_condition' target='test_activer_kerberos'>
            <param>['oui','NTLM/KERBEROS']</param>
            <param type='eole' name='condition_1'>activer_squid_auth</param>
            <param type='eole' name='condition_2'>type_squid_auth</param>
            <param name='match'>oui</param>
            <param name='mismatch'>non</param>
        </auto>
        <condition name='hidden_if_in' source='test_activer_kerberos'>
            <param>non</param>
            <target type='servicelist'>kerberos</target>
            <target type='filelist'>kerberos</target>
        </condition>

        <condition name='hidden_if_not_in' source='type_squid_auth'>
            <param>NTLM/SMB</param>
            <target type='variable'>nom_serveur_smb</target>
            <target type='variable'>nom_domaine_smb</target>
            <target type='variable'>ip_serveur_smb</target>
        </condition>
        <condition name='hidden_if_not_in' source='type_squid_auth'>
            <param>NTLM/KERBEROS</param>
            <target type='variable'>nom_serveur_krb</target>
            <target type='variable'>nom_domaine_krb</target>
            <target type='variable'>nom_domaine_windows</target>
            <target type='variable'>ip_serveur_krb</target>
        </condition>
        <condition name='hidden_if_not_in' source='type_squid_auth'>
            <param>Ldap</param>
            <target type='variable'>ip_serveur_ldap1</target>
            <target type='variable'>ip_serveur_ldap2</target>
            <target type='variable'>ldap_base_dn</target>
        </condition>
        <condition name='hidden_if_not_in' source='type_squid_auth'>
            <param>Ldap (Active Directory)</param>
            <target type='variable'>ip_serveur_ldapad</target>
            <target type='variable'>ldapad_base_dn</target>
            <target type='variable'>ldapad_user</target>
            <target type='variable'>ldapad_passwd</target>
        </condition>
        <check name='obligatoire' target='nom_domaine_smb'/>
        <check name='obligatoire' target='nom_serveur_smb'/>
        <check name='obligatoire' target='ip_serveur_smb'/>
        <check name='obligatoire' target='nom_domaine_krb'/>
        <check name='obligatoire' target='nom_domaine_windows'/>
        <check name='obligatoire' target='nom_serveur_krb'/>
        <check name='obligatoire' target='ip_serveur_krb'/>
        <check name='obligatoire' target='ip_serveur_ldap1'/>
        <check name='obligatoire' target='ip_serveur_ldapad'/>
        <check name='obligatoire' target='ldap_base_dn'/>
        <check name='obligatoire' target='ldapad_base_dn'/>
        <check name='obligatoire' target='ldapad_user'/>
        <check name='obligatoire' target='ldapad_passwd'/>
        <!--variables communes aux deux zones-->
        <check name='obligatoire' target='dans_num_opt_filters'/>
        <check name="valid_enum" target="dans_num_opt_filters">
            <param>['0','1','2','3','4']</param>
        </check>
        <!--variables de la zone 1 ( 0)-->
        <check name='obligatoire' target='maxchildren1'/>
        <check name='obligatoire' target='minchildren1'/>
        <check name='obligatoire' target='minsparechildren1'/>
        <check name='obligatoire' target='maxsparechildren1'/>
        <check name='obligatoire' target='preforkchildren1'/>
        <check name='obligatoire' target='maxagechildren1'/>
        <check name='obligatoire' target='unactive_dansguardian_auth1'/>
        <check name="valid_entier" target="maxchildren1">
            <param name="mini">60</param>
        </check>
        <check name="valid_enum" target="unactive_dansguardian_auth1" >
            <param>['---', 'oui','non']</param>
        </check>
        <check name="valid_enum" target='dansguardian_eth1'>
            <param>['1','2']</param>
        </check>
        <check name="valid_enum" target='dansguardian_eth2'>
            <param>['1','2']</param>
        </check>
        <check name="valid_enum" target='dansguardian_eth3'>
            <param>['1','2']</param>
        </check>
        <check name="valid_enum" target='dansguardian_eth4'>
            <param>['1','2']</param>
        </check>

        <!--variables de la zone 2 ( 1) -->
        <check name='obligatoire' target='maxchildren2'/>
        <check name='obligatoire' target='minchildren2'/>
        <check name='obligatoire' target='minsparechildren2'/>
        <check name='obligatoire' target='maxsparechildren2'/>
        <check name='obligatoire' target='preforkchildren2'/>
        <check name='obligatoire' target='maxagechildren2'/>
        <check name='obligatoire' target='unactive_dansguardian_auth2'/>

        <check name="valid_entier" target="maxchildren2">
            <param name="mini">60</param>
        </check>
        <check name="valid_enum" target="unactive_dansguardian_auth2" >
            <param>['---','oui','non']</param>
        </check>
        <condition name='hidden_if_in' source='activer_squid_auth'>
            <param>non</param>
            <target type='family'>proxy authentifié</target>
            <target type='variable'>squid_auth_eth1</target>
            <target type='variable'>squid_auth_eth2</target>
            <target type='variable'>squid_auth_eth3</target>
            <target type='variable'>squid_auth_eth4</target>
        </condition>
        <group master='nom_cache_pere_zone'>
            <slave>port_cache_pere_zone</slave>
            <slave>nom_zone_dns_cache</slave>
            <slave>autoriser_proxy_autres</slave>
        </group>

        <check name='obligatoire' target='adresse_ip_eth1_proxy_link'/>
        <check name='obligatoire' target='adresse_mask_eth1_proxy_link'/>
        <check name='obligatoire' target='adresse_bcast_eth1_proxy_link'/>
        <check name='obligatoire' target='adresse_ip_eth2_proxy_link'/>
        <check name='obligatoire' target='adresse_mask_eth2_proxy_link'/>
        <check name='obligatoire' target='adresse_bcast_eth2_proxy_link'/>
        <check name='obligatoire' target='adresse_ip_eth3_proxy_link'/>
        <check name='obligatoire' target='adresse_mask_eth3_proxy_link'/>
        <check name='obligatoire' target='adresse_bcast_eth3_proxy_link'/>
        <condition name='hidden_if_in' source='mode_conteneur_actif'>
            <param>non</param>
            <target>adresse_ip_eth1_proxy_link</target>
            <target>adresse_mask_eth1_proxy_link</target>
            <target>adresse_bcast_eth1_proxy_link</target>
            <target>adresse_ip_eth2_proxy_link</target>
            <target>adresse_mask_eth2_proxy_link</target>
            <target>adresse_bcast_eth2_proxy_link</target>
            <target>adresse_ip_eth3_proxy_link</target>
            <target>adresse_mask_eth3_proxy_link</target>
            <target>adresse_bcast_eth3_proxy_link</target>
        </condition>
        <fill name='calc_val' target='adresse_bcast_eth1_proxy_link'>
            <param type='eole' name='valeur'>adresse_broadcast_eth1</param>
        </fill>
        <fill name='calc_val' target='adresse_mask_eth1_proxy_link'>
            <param type='eole' name='valeur'>adresse_netmask_eth1</param>
        </fill>
        <fill name='calc_val' target='adresse_bcast_eth2_proxy_link'>
            <param type='eole' name='valeur'>adresse_broadcast_eth2</param>
        </fill>
        <fill name='calc_val' target='adresse_mask_eth2_proxy_link'>
            <param type='eole' name='valeur'>adresse_netmask_eth2</param>
        </fill>
        <fill name='calc_val' target='adresse_bcast_eth3_proxy_link'>
            <param type='eole' name='valeur'>adresse_broadcast_eth3</param>
        </fill>
        <fill name='calc_val' target='adresse_mask_eth3_proxy_link'>
            <param type='eole' name='valeur'>adresse_netmask_eth3</param>
        </fill>

        <check name='obligatoire' target='http_port'/>
        <check name='obligatoire' target='number_of_basic_children'/>
        <check name='obligatoire' target='number_of_ntlm_children'/>
        <check name='obligatoire' target='icp_port'/>
        <check name='obligatoire' target='htcp_port'/>
        <check name='obligatoire' target='icp_query_timeout'/>
        <check name='obligatoire' target='maximum_icp_query_timeout'/>
        <check name='obligatoire' target='mcast_icp_query_timeout'/>
        <check name='obligatoire' target='dead_peer_timeout'/>
        <check name='obligatoire' target='hierarchy_stoplist'/>
        <!--<check name='obligatoire' target='cache_vary'/>-->
        <check name='obligatoire' target='cache_mem'/>
        <check name='obligatoire' target='cache_swap_low'/>
        <check name='obligatoire' target='cache_swap_high'/>
        <check name='obligatoire' target='minimum_object_size'/>
        <check name='obligatoire' target='maximum_object_size'/>
        <check name='obligatoire' target='maximum_object_size_in_memory'/>
        <check name='obligatoire' target='ipcache_size'/>
        <check name='obligatoire' target='ipcache_low'/>
        <check name='obligatoire' target='ipcache_high'/>
        <check name='obligatoire' target='fqdncache_size'/>
        <check name='obligatoire' target='cache_replacement_policy'/>
        <check name='obligatoire' target='memory_replacement_policy'/>
        <check name='obligatoire' target='cache_dir'/>
        <check name='obligatoire' target='cache_dir_disk_space'/>
        <check name='obligatoire' target='cache_dir_firstLevel'/>
        <check name='obligatoire' target='cache_dir_secondLevel'/>
        <check name='obligatoire' target='client_netmask'/>
        <check name='obligatoire' target='ftp_user'/>
        <!--<check name='obligatoire' target='ftp_list_width'/>-->
        <!--<check name='obligatoire' target='cache_dns_program'/>-->
        <!--<check name='obligatoire' target='dns_children'/>-->
        <!--<check name='obligatoire' target='dns_retransmit_interval'/>-->
        <!--<check name='obligatoire' target='dns_timeout'/>-->
        <check name='obligatoire' target='hosts_file'/>
        <!--<check name='obligatoire' target='wais_relay_port'/>-->
        <check name='obligatoire' target='request_header_max_size'/>
        <check name='obligatoire' target='request_body_max_size'/>
        <check name='obligatoire' target='quick_abort_min'/>
        <check name='obligatoire' target='quick_abort_max'/>
        <check name='obligatoire' target='quick_abort_pct'/>
        <check name='obligatoire' target='negative_ttl'/>
        <check name='obligatoire' target='positive_dns_ttl'/>
        <check name='obligatoire' target='negative_dns_ttl'/>
        <check name='obligatoire' target='range_offset_limit'/>
        <!--<check name='obligatoire' target='refresh_stale_hit'/>-->
        <check name='obligatoire' target='forward_timeout'/>
        <check name='obligatoire' target='connect_timeout'/>
        <check name='obligatoire' target='peer_connect_timeout'/>
        <check name='obligatoire' target='read_timeout'/>
        <check name='obligatoire' target='request_timeout'/>
        <check name='obligatoire' target='persistent_request_timeout'/>
        <check name='obligatoire' target='client_lifetime'/>
        <check name='obligatoire' target='pconn_timeout'/>
        <check name='obligatoire' target='ident_timeout'/>
        <check name='obligatoire' target='shutdown_lifetime'/>
        <!--<check name="valid_enum" target='cache_vary'>
            <param>['on','off']</param>
        </check>-->
        <check name="valid_enum" target="cache_replacement_policy">
            <param>['lru','heap GDSF','heap LFUDA','heap LRU']</param>
        </check>

        <check name="valid_enum" target="memory_replacement_policy">
            <param>['lru','heap GDSF','heap LFUDA','heap LRU']</param>
        </check>
        <check name="valid_enum" target="cache_dir_type">
            <param>['ufs']</param>
        </check>
        <group master='cache_dir'>
            <slave>cache_dir_type</slave>
            <slave>cache_dir_disk_space</slave>
            <slave>cache_dir_firstLevel</slave>
            <slave>cache_dir_secondLevel</slave>
        </group>
        <auto name='calc_multi_condition' target='test_activer_clam_proxy'>
            <param>oui</param>
            <param type='eole' name='condition_1'>activer_clam</param>
            <param type='eole' name='condition_2'>dansguardian_clam</param>
            <param name='match'>oui</param>
            <param name='mismatch'>non</param>
        </auto>
        <condition name='hidden_if_in' source='test_activer_clam_proxy'>
            <param>non</param>
            <target type='servicelist'>clamav_proxy</target>
        </condition>
    </constraints>

    <help>
        <variable name='dansguardian_eth1'>Instance de DansGuardian à utiliser pour l'interface eth1 (1=Configuration 1, 2=Configuration 2)</variable>
        <variable name='dansguardian_eth2'>Indice de la configuration(filtrage et pare-feu) choisie pour l'interface eth2 (1=admin, 2=pedago)</variable>
        <variable name='dansguardian_eth3'>Indice de la configuration(filtrage et pare-feu) choisie pour l'interface eth3 (1=admin, 2=pedago)</variable>
        <variable name='dansguardian_eth4'>Indice de la configuration(filtrage et pare-feu) choisie pour l'interface eth4 (1=admin, 2=pedago)</variable>
        <variable name='dans_num_opt_filters'>Nombre de politique optionnelle (1, 2 et 3) à activer, diminuer permet un gain de performance</variable>
        <variable name='adresse_ip_eth1_proxy_link'>Adresse IP supplémentaire sur cette interface réseau, utilisée pour accèder au proxy. Le serveur aura donc plusieurs adresses IP sur le réseau local.</variable>
        <variable name='adresse_ip_eth2_proxy_link'>Adresse IP supplémentaire sur cette interface réseau, utilisée pour accèder au proxy. Le serveur aura donc plusieurs adresses IP sur le réseau local.</variable>
    </help>

</creole>
<!-- vim: ts=4 sw=4 expandtab
-->
