<?xml version="1.0" encoding="utf-8"?>

<creole>
	<files>
	<file name='/etc/nginx/sites-enabled/default' source='nginx.default'/>
	</files>
	<!--************************************************************************************************* -->
	<variables>
	<!--************************************************************************************************* -->
		<family name='services'>
			<variable name='activer_revprox' type='string' description='Activation du reverse proxy'>
				<value>non</value>
			</variable>
		</family>
		<family name='Reverse proxy' hidden='True'>
			<variable name='revprox_sso' type='string' description="IP ou domaine du serveur SSO redirigé" />
			<variable name='revprox_poshadmin' type='string' description="IP ou domaine du serveur EnvOLE 2 admin a redirigé" />
			<variable name='revprox_domainname' type='string' description="Nom de domaine à rediriger" multi='True' />
			<variable name='revprox_rep' type='string' description="Répertoire ou non de la page à rediriger">
				<value>/</value>
			</variable>
			<variable name='revprox_http' type='string' description="Reverse proxy HTTP">
				<value>redirige vers https</value>
			</variable>
			<variable name='revprox_https' type='string' description="Reverse proxy HTTPS">
				<value>oui</value>
			</variable>
			<variable name='revprox_url' type='string' description="URL racine de destination (avec http ou https)">
				<value></value>
			</variable>
		</family>
		<separators>
			<separator name='revprox_sso'>Redirection de services particuliers</separator>
			<separator name='revprox_domainname'>Redirection HTTP et HTTPS</separator>
		</separators>
	</variables>
	<constraints>
	<!--************************************************************************************************* -->
	<!-- **** Listes deroulantes **** -->
		<check name='valid_enum' target='activer_revprox'>
			<param>['oui','non']</param>
		</check>
		<check name='valid_enum' target='revprox_http'>
			<param>['oui','non', 'redirige vers https']</param>
		</check>
		<check name='valid_enum' target='revprox_https'>
			<param>['oui','non']</param>
		</check>
	<!-- **** Conditions **** -->
		<condition name='hidden_if_in' source='activer_revprox'>
			<param>non</param>
			<target type='family'>Reverse proxy</target>
			<target type='filelist'>revpro</target>
                </condition>
	<!-- **** Groupes **** -->
		 <group master='revprox_domainname'>
			<slave>revprox_rep</slave>
			<slave>revprox_url</slave>
			<slave>revprox_http</slave>
			<slave>revprox_https</slave>
		 </group>
	</constraints>
	<!--************************************************************************************************* -->
	<help>
                <variable name='revprox_sso'>Pour rediriger vers le SSO de la machine "domainelocal", taper "domainelocal"</variable>
                <variable name='revprox_poshadmin'>Pour rediriger vers le POSHAdmin de la machine "domainelocal", taper "domainelocal"</variable>
                <variable name='revprox_domainname'>Exemple pour rediriger "http://domaine/", taper "domaine"</variable>
                <variable name='revprox_rep'>URL relative (sans le nom de domaine) redirigé pour l'adresse définie dans la variable ci-dessus (exemple "/mail")</variable>
                <variable name='revprox_url'>Nom de domaine ou IP de destination, par exemple "http://domainelocal"</variable>

	</help>
</creole>
